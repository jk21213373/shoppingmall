{"version":3,"file":"address-form.js","sources":["../../../../../src/pagesMember/address-form/address-form.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJcYWRkcmVzcy1mb3JtXGFkZHJlc3MtZm9ybS52dWU"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport {\r\n  getMemberAddressByIdAPI,\r\n  postMemberAddressAPI,\r\n  putMemberAddressByIdAPI,\r\n} from '@/services/address'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref } from 'vue'\r\n\r\n// 表单数据\r\nconst form = ref({\r\n  receiver: '', // 收货人\r\n  contact: '', // 联系方式\r\n  fullLocation: '', // 省市区(前端展示)\r\n  provinceCode: '', // 省份编码(后端参数)\r\n  cityCode: '', // 城市编码(后端参数)\r\n  countyCode: '', // 区/县编码(后端参数)\r\n  address: '', // 详细地址\r\n  isDefault: 0, // 默认地址，1为是，0为否\r\n})\r\n\r\n// 获取页面参数\r\nconst query = defineProps<{\r\n  id?: string\r\n}>()\r\n\r\n// 获取收货地址详情数据\r\nconst getMemberAddressByIdData = async () => {\r\n  if (query.id) {\r\n    // 发送请求\r\n    const res = await getMemberAddressByIdAPI(query.id)\r\n    // 把数据合并到表单中\r\n    Object.assign(form.value, res.result)\r\n  }\r\n}\r\n\r\n// 页面加载\r\nonLoad(() => {\r\n  getMemberAddressByIdData()\r\n})\r\n\r\n// 动态设置标题\r\nuni.setNavigationBarTitle({ title: query.id ? '修改地址' : '新建地址' })\r\n\r\n// 收集所在地区\r\nconst onRegionChange: UniHelper.RegionPickerOnChange = (ev) => {\r\n  // 省市区(前端展示)\r\n  form.value.fullLocation = ev.detail.value.join(' ')\r\n  // 省市区(后端参数)\r\n  const [provinceCode, cityCode, countyCode] = ev.detail.code!\r\n  // form.value.provinceCode = provinceCode\r\n  Object.assign(form.value, { provinceCode, cityCode, countyCode })\r\n}\r\n\r\n// 收集是否默认收货地址\r\nconst onSwitchChange: UniHelper.SwitchOnChange = (ev) => {\r\n  form.value.isDefault = ev.detail.value ? 1 : 0\r\n}\r\n\r\n// 定义校验规则\r\nconst rules: UniHelper.UniFormsRules = {\r\n  receiver: {\r\n    rules: [{ required: true, errorMessage: '请输入收货人姓名' }],\r\n  },\r\n  contact: {\r\n    rules: [\r\n      { required: true, errorMessage: '请输入联系方式' },\r\n      { pattern: /^1[3-9]\\d{9}$/, errorMessage: '手机号格式不正确' },\r\n    ],\r\n  },\r\n  countyCode: {\r\n    rules: [{ required: true, errorMessage: '请选择所在地区' }],\r\n  },\r\n  address: {\r\n    rules: [{ required: true, errorMessage: '请选择详细地址' }],\r\n  },\r\n}\r\n\r\n// 表单组件实例\r\nconst formRef = ref<UniHelper.UniFormsInstance>()\r\n\r\n// 提交表单\r\nconst onSubmit = async () => {\r\n  try {\r\n    // 表单校验\r\n    await formRef.value?.validate?.()\r\n    // 校验通过后再发送请求\r\n    if (query.id) {\r\n      // 修改地址请求\r\n      await putMemberAddressByIdAPI(query.id, form.value)\r\n    } else {\r\n      // 新建地址请求\r\n      await postMemberAddressAPI(form.value)\r\n    }\r\n    // 成功提示\r\n    uni.showToast({ icon: 'success', title: query.id ? '修改成功' : '添加成功' })\r\n    // 返回上一页\r\n    setTimeout(() => {\r\n      uni.navigateBack()\r\n    }, 400)\r\n  } catch (error) {\r\n    uni.showToast({ icon: 'error', title: '请填写完整信息' })\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</script>\r\n\r\n<template>\r\n  <view class=\"content\">\r\n    <uni-forms :rules=\"rules\" :model=\"form\" ref=\"formRef\">\r\n      <!-- 表单内容 -->\r\n      <uni-forms-item name=\"receiver\" class=\"form-item\">\r\n        <text class=\"label\">收货人</text>\r\n        <input class=\"input\" placeholder=\"请填写收货人姓名\" v-model=\"form.receiver\" />\r\n      </uni-forms-item>\r\n      <uni-forms-item name=\"contact\" class=\"form-item\">\r\n        <text class=\"label\">手机号码</text>\r\n        <input\r\n          class=\"input\"\r\n          placeholder=\"请填写收货人手机号码\"\r\n          :maxlength=\"11\"\r\n          v-model=\"form.contact\"\r\n        />\r\n      </uni-forms-item>\r\n      <uni-forms-item name=\"countyCode\" class=\"form-item\">\r\n        <text class=\"label\">所在地区</text>\r\n\r\n        <picker\r\n          @change=\"onRegionChange\"\r\n          class=\"picker\"\r\n          mode=\"region\"\r\n          :value=\"form.fullLocation.split(' ')\"\r\n        >\r\n          <view v-if=\"form.fullLocation\">{{ form.fullLocation }}</view>\r\n          <view v-else class=\"placeholder\">请选择省/市/区(县)</view>\r\n        </picker>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      </uni-forms-item>\r\n      <uni-forms-item name=\"address\" class=\"form-item\">\r\n        <text class=\"label\">详细地址</text>\r\n        <input class=\"input\" placeholder=\"街道、楼牌号等信息\" v-model=\"form.address\" />\r\n      </uni-forms-item>\r\n      <view class=\"form-item\">\r\n        <label class=\"label\">设为默认地址</label>\r\n        <switch\r\n          @change=\"onSwitchChange\"\r\n          class=\"switch\"\r\n          color=\"#27ba9b\"\r\n          :checked=\"form.isDefault === 1\"\r\n        />\r\n      </view>\r\n    </uni-forms>\r\n  </view>\r\n  <!-- 提交按钮 -->\r\n  <button @tap=\"onSubmit\" class=\"button\">保存并使用</button>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n// 深度选择器修改 uni-data-picker 组件样式\r\n:deep(.selected-area) {\r\n  flex: 0 1 auto;\r\n  height: auto;\r\n}\r\n\r\npage {\r\n  background-color: #f4f4f4;\r\n}\r\n\r\n.content {\r\n  margin: 20rpx 20rpx 0;\r\n  padding: 0 20rpx;\r\n  border-radius: 10rpx;\r\n  background-color: #fff;\r\n\r\n  .form-item,\r\n  .uni-forms-item {\r\n    display: flex;\r\n    align-items: center;\r\n    min-height: 96rpx;\r\n    padding: 25rpx 10rpx;\r\n    background-color: #fff;\r\n    font-size: 28rpx;\r\n    border-bottom: 1rpx solid #ddd;\r\n    position: relative;\r\n    margin-bottom: 0;\r\n\r\n    // 调整 uni-forms 样式\r\n    .uni-forms-item__content {\r\n      display: flex;\r\n    }\r\n\r\n    .uni-forms-item__error {\r\n      margin-left: 200rpx;\r\n    }\r\n\r\n    &:last-child {\r\n      border: none;\r\n    }\r\n\r\n    .label {\r\n      width: 200rpx;\r\n      color: #333;\r\n    }\r\n\r\n    .input {\r\n      flex: 1;\r\n      display: block;\r\n      height: 46rpx;\r\n    }\r\n\r\n    .switch {\r\n      position: absolute;\r\n      right: -20rpx;\r\n      transform: scale(0.8);\r\n    }\r\n\r\n    .picker {\r\n      flex: 1;\r\n    }\r\n\r\n    .placeholder {\r\n      color: #808080;\r\n    }\r\n  }\r\n}\r\n\r\n.button {\r\n  height: 80rpx;\r\n  margin: 30rpx 20rpx;\r\n  color: #fff;\r\n  border-radius: 80rpx;\r\n  font-size: 30rpx;\r\n  background-color: #27ba9b;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Dell/Desktop/test/summer-fun-shopping/src/pagesMember/address-form/address-form.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getMemberAddressByIdAPI","onLoad","uni","putMemberAddressByIdAPI","postMemberAddressAPI"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAUA,UAAM,OAAOA,cAAAA,IAAI;AAAA,MACf,UAAU;AAAA;AAAA,MACV,SAAS;AAAA;AAAA,MACT,cAAc;AAAA;AAAA,MACd,cAAc;AAAA;AAAA,MACd,UAAU;AAAA;AAAA,MACV,YAAY;AAAA;AAAA,MACZ,SAAS;AAAA;AAAA,MACT,WAAW;AAAA;AAAA,IAAA,CACZ;AAQD,UAAM,2BAA2B,YAAY;AAC3C,UAAI,MAAM,IAAI;AAEZ,cAAM,MAAM,MAAMC,iBAAAA,wBAAwB,MAAM,EAAE;AAElD,eAAO,OAAO,KAAK,OAAO,IAAI,MAAM;AAAA,MACtC;AAAA,IAAA;AAIFC,kBAAAA,OAAO,MAAM;AACc;IAAA,CAC1B;AAGDC,wBAAI,sBAAsB,EAAE,OAAO,MAAM,KAAK,SAAS,QAAQ;AAGzD,UAAA,iBAAiD,CAAC,OAAO;AAE7D,WAAK,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AAElD,YAAM,CAAC,cAAc,UAAU,UAAU,IAAI,GAAG,OAAO;AAEvD,aAAO,OAAO,KAAK,OAAO,EAAE,cAAc,UAAU,YAAY;AAAA,IAAA;AAI5D,UAAA,iBAA2C,CAAC,OAAO;AACvD,WAAK,MAAM,YAAY,GAAG,OAAO,QAAQ,IAAI;AAAA,IAAA;AAI/C,UAAM,QAAiC;AAAA,MACrC,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,YAAY;AAAA,MACtD;AAAA,MACA,SAAS;AAAA,QACP,OAAO;AAAA,UACL,EAAE,UAAU,MAAM,cAAc,UAAU;AAAA,UAC1C,EAAE,SAAS,iBAAiB,cAAc,WAAW;AAAA,QACvD;AAAA,MACF;AAAA,MACA,YAAY;AAAA,QACV,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACrD;AAAA,MACA,SAAS;AAAA,QACP,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACrD;AAAA,IAAA;AAIF,UAAM,UAAUH,cAAAA;AAGhB,UAAM,WAAW,YAAY;;AACvB,UAAA;AAEI,gBAAA,mBAAQ,UAAR,mBAAe,aAAf;AAEN,YAAI,MAAM,IAAI;AAEZ,gBAAMI,iBAAwB,wBAAA,MAAM,IAAI,KAAK,KAAK;AAAA,QAAA,OAC7C;AAEC,gBAAAC,iBAAA,qBAAqB,KAAK,KAAK;AAAA,QACvC;AAEIF,sBAAAA,MAAA,UAAU,EAAE,MAAM,WAAW,OAAO,MAAM,KAAK,SAAS,OAAA,CAAQ;AAEpE,mBAAW,MAAM;AACfA,wBAAA,MAAI,aAAa;AAAA,WAChB,GAAG;AAAA,eACC,OAAO;AACdA,sBAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,WAAW;AAAA,MACnD;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrGF,GAAG,WAAW,eAAe;"}