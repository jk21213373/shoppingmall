{"version":3,"file":"profile.js","sources":["../../../../../src/pagesMember/profile/profile.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJccHJvZmlsZVxwcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { getMemberProfileAPI, putMemberProfileAPI } from '@/services/profile'\r\nimport { useMemberStore } from '@/stores'\r\nimport type { Gender, ProfileDetail } from '@/types/member'\r\nimport { formatDate } from '@/utils'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref } from 'vue'\r\n\r\n// 获取屏幕边界到安全区域距离\r\nconst { safeAreaInsets } = uni.getSystemInfoSync()\r\n\r\n// 获取个人信息，修改个人信息需提供初始值\r\nconst profile = ref({} as ProfileDetail)\r\nconst getMemberProfileData = async () => {\r\n  const res = await getMemberProfileAPI()\r\n  profile.value = res.result\r\n  // 同步 Store 的头像和昵称，用于我的页面展示\r\n  memberStore.profile!.avatar = res.result.avatar\r\n  memberStore.profile!.nickname = res.result.nickname\r\n}\r\n\r\nonLoad(() => {\r\n  getMemberProfileData()\r\n})\r\n\r\nconst memberStore = useMemberStore()\r\n// 修改头像\r\nconst onAvatarChange = () => {\r\n  // 调用拍照/选择图片\r\n  // 选择图片条件编译\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  // uni.chooseMedia 仅支持微信小程序端\r\n  uni.chooseMedia({\r\n    // 文件个数\r\n    count: 1,\r\n    // 文件类型\r\n    mediaType: ['image'],\r\n    success: (res) => {\r\n      // 本地路径\r\n      const { tempFilePath } = res.tempFiles[0]\r\n      // 上传\r\n      uploadFile(tempFilePath)\r\n    },\r\n  })\r\n\r\n}\r\n\r\n// 文件上传-兼容小程序端、H5端、App端\r\nconst uploadFile = (file: string) => {\r\n  // 文件上传\r\n  uni.uploadFile({\r\n    url: '/member/profile/avatar',\r\n    name: 'file',\r\n    filePath: file,\r\n    success: (res) => {\r\n      if (res.statusCode === 200) {\r\n        const avatar = JSON.parse(res.data).result.avatar\r\n        // 个人信息页数据更新\r\n        profile.value!.avatar = avatar\r\n        // Store头像更新\r\n        memberStore.profile!.avatar = avatar\r\n        uni.showToast({ icon: 'success', title: '更新成功' })\r\n      } else {\r\n        uni.showToast({ icon: 'error', title: '出现错误' })\r\n      }\r\n    },\r\n  })\r\n}\r\n\r\n// 修改性别\r\nconst onGenderChange: UniHelper.RadioGroupOnChange = (ev) => {\r\n  profile.value.gender = ev.detail.value as Gender\r\n}\r\n\r\n// 修改生日\r\nconst onBirthdayChange: UniHelper.DatePickerOnChange = (ev) => {\r\n  profile.value.birthday = ev.detail.value\r\n}\r\n\r\n// 修改城市\r\nlet fullLocationCode: [string, string, string] = ['', '', '']\r\nconst onFullLocationChange: UniHelper.RegionPickerOnChange = (ev) => {\r\n  // 修改前端界面\r\n  profile.value.fullLocation = ev.detail.value.join(' ')\r\n  // 提交后端更新\r\n  fullLocationCode = ev.detail.code!\r\n}\r\n\r\n// 点击保存提交表单\r\nconst onSubmit = async () => {\r\n  const { nickname, gender, birthday } = profile.value\r\n  const res = await putMemberProfileAPI({\r\n    nickname,\r\n    gender,\r\n    birthday,\r\n    provinceCode: fullLocationCode[0],\r\n    cityCode: fullLocationCode[1],\r\n    countyCode: fullLocationCode[2],\r\n  })\r\n  // 更新Store昵称\r\n  memberStore.profile!.nickname = res.result.nickname\r\n  uni.showToast({ icon: 'success', title: '保存成功' })\r\n  setTimeout(() => {\r\n    uni.navigateBack()\r\n  }, 400)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <view class=\"viewport\">\r\n    <!-- 导航栏 -->\r\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\r\n      <navigator open-type=\"navigateBack\" class=\"back icon-left\" hover-class=\"none\"></navigator>\r\n      <view class=\"title\">个人信息</view>\r\n    </view>\r\n    <!-- 头像 -->\r\n    <view class=\"avatar\">\r\n      <view @tap=\"onAvatarChange\" class=\"avatar-content\">\r\n        <image class=\"image\" :src=\"profile?.avatar\" mode=\"aspectFill\" />\r\n        <text class=\"text\">点击修改头像</text>\r\n      </view>\r\n    </view>\r\n    <!-- 表单 -->\r\n    <view class=\"form\">\r\n      <!-- 表单内容 -->\r\n      <view class=\"form-content\">\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">账号</text>\r\n          <text class=\"account placeholder\">{{ profile?.account }}</text>\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">昵称</text>\r\n          <input class=\"input\" type=\"text\" placeholder=\"请填写昵称\" v-model=\"profile!.nickname\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">性别</text>\r\n          <radio-group @change=\"onGenderChange\">\r\n            <label class=\"radio\">\r\n              <radio value=\"男\" color=\"#27ba9b\" :checked=\"profile?.gender === '男'\" />\r\n              男\r\n            </label>\r\n            <label class=\"radio\">\r\n              <radio value=\"女\" color=\"#27ba9b\" :checked=\"profile?.gender === '女'\" />\r\n              女\r\n            </label>\r\n          </radio-group>\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">生日</text>\r\n          <picker\r\n            @change=\"onBirthdayChange\"\r\n            mode=\"date\"\r\n            class=\"picker\"\r\n            :value=\"profile?.birthday\"\r\n            start=\"1900-01-01\"\r\n            :end=\"formatDate(new Date())\"\r\n          >\r\n            <view v-if=\"profile?.birthday\">{{ profile?.birthday }}</view>\r\n            <view class=\"placeholder\" v-else>请选择日期</view>\r\n          </picker>\r\n        </view>\r\n        <!-- 只有微信小程序端内置了省市区数据 -->\r\n\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">城市</text>\r\n          <picker\r\n            @change=\"onFullLocationChange\"\r\n            mode=\"region\"\r\n            class=\"picker\"\r\n            :value=\"profile?.fullLocation?.split(' ')\"\r\n          >\r\n            <view v-if=\"profile?.fullLocation\">{{ profile.fullLocation }}</view>\r\n            <view class=\"placeholder\" v-else>请选择城市</view>\r\n          </picker>\r\n        </view>\r\n\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">职业</text>\r\n          <input class=\"input\" type=\"text\" placeholder=\"请填写职业\" :value=\"profile?.profession\" />\r\n        </view>\r\n      </view>\r\n      <!-- 提交按钮 -->\r\n      <button @tap=\"onSubmit\" class=\"form-button\">保 存</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  background-color: #f4f4f4;\r\n}\r\n\r\n.viewport {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\r\n  background-size: auto 420rpx;\r\n  background-repeat: no-repeat;\r\n}\r\n\r\n// 导航栏\r\n.navbar {\r\n  position: relative;\r\n\r\n  .title {\r\n    height: 40px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-size: 16px;\r\n    font-weight: 500;\r\n    color: #fff;\r\n  }\r\n\r\n  .back {\r\n    position: absolute;\r\n    height: 40px;\r\n    width: 40px;\r\n    left: 0;\r\n    font-size: 20px;\r\n    color: #fff;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n}\r\n\r\n// 头像\r\n.avatar {\r\n  text-align: center;\r\n  width: 100%;\r\n  height: 260rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  .image {\r\n    width: 160rpx;\r\n    height: 160rpx;\r\n    border-radius: 50%;\r\n    background-color: #eee;\r\n  }\r\n\r\n  .text {\r\n    display: block;\r\n    padding-top: 20rpx;\r\n    line-height: 1;\r\n    font-size: 26rpx;\r\n    color: #fff;\r\n  }\r\n}\r\n\r\n// 表单\r\n.form {\r\n  background-color: #f4f4f4;\r\n\r\n  &-content {\r\n    margin: 20rpx 20rpx 0;\r\n    padding: 0 20rpx;\r\n    border-radius: 10rpx;\r\n    background-color: #fff;\r\n  }\r\n\r\n  &-item {\r\n    display: flex;\r\n    height: 96rpx;\r\n    line-height: 46rpx;\r\n    padding: 25rpx 10rpx;\r\n    background-color: #fff;\r\n    font-size: 28rpx;\r\n    border-bottom: 1rpx solid #ddd;\r\n\r\n    &:last-child {\r\n      border: none;\r\n    }\r\n\r\n    .label {\r\n      width: 180rpx;\r\n      color: #333;\r\n    }\r\n\r\n    .account {\r\n      color: #666;\r\n    }\r\n\r\n    .input {\r\n      flex: 1;\r\n      display: block;\r\n      height: 46rpx;\r\n    }\r\n\r\n    .radio {\r\n      margin-right: 20rpx;\r\n    }\r\n\r\n    .picker {\r\n      flex: 1;\r\n    }\r\n    .placeholder {\r\n      color: #808080;\r\n    }\r\n  }\r\n\r\n  &-button {\r\n    height: 80rpx;\r\n    text-align: center;\r\n    line-height: 80rpx;\r\n    margin: 30rpx 20rpx;\r\n    color: #fff;\r\n    border-radius: 80rpx;\r\n    font-size: 30rpx;\r\n    background-color: #27ba9b;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Dell/Desktop/test/summer-fun-shopping/src/pagesMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","onLoad","useMemberStore","putMemberProfileAPI"],"mappings":";;;;;;;;;;AASA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAG3C,UAAA,UAAUC,kBAAI,CAAA,CAAmB;AACvC,UAAM,uBAAuB,YAAY;AACjC,YAAA,MAAM,MAAMC,iBAAAA;AAClB,cAAQ,QAAQ,IAAI;AAER,kBAAA,QAAS,SAAS,IAAI,OAAO;AAC7B,kBAAA,QAAS,WAAW,IAAI,OAAO;AAAA,IAAA;AAG7CC,kBAAAA,OAAO,MAAM;AACU;IAAA,CACtB;AAED,UAAM,cAAcC,sBAAAA;AAEpB,UAAM,iBAAiB,MAAM;AAkB3BJ,oBAAAA,MAAI,YAAY;AAAA;AAAA,QAEd,OAAO;AAAA;AAAA,QAEP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAS,CAAC,QAAQ;AAEhB,gBAAM,EAAE,aAAiB,IAAA,IAAI,UAAU,CAAC;AAExC,qBAAW,YAAY;AAAA,QACzB;AAAA,MAAA,CACD;AAAA,IAAA;AAKG,UAAA,aAAa,CAAC,SAAiB;AAEnCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,QACL,MAAM;AAAA,QACN,UAAU;AAAA,QACV,SAAS,CAAC,QAAQ;AACZ,cAAA,IAAI,eAAe,KAAK;AAC1B,kBAAM,SAAS,KAAK,MAAM,IAAI,IAAI,EAAE,OAAO;AAE3C,oBAAQ,MAAO,SAAS;AAExB,wBAAY,QAAS,SAAS;AAC9BA,0BAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAAA,UAAA,OAC3C;AACLA,0BAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,QAAQ;AAAA,UAChD;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAIG,UAAA,iBAA+C,CAAC,OAAO;AACnD,cAAA,MAAM,SAAS,GAAG,OAAO;AAAA,IAAA;AAI7B,UAAA,mBAAiD,CAAC,OAAO;AACrD,cAAA,MAAM,WAAW,GAAG,OAAO;AAAA,IAAA;AAIrC,QAAI,mBAA6C,CAAC,IAAI,IAAI,EAAE;AACtD,UAAA,uBAAuD,CAAC,OAAO;AAEnE,cAAQ,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AAErD,yBAAmB,GAAG,OAAO;AAAA,IAAA;AAI/B,UAAM,WAAW,YAAY;AAC3B,YAAM,EAAE,UAAU,QAAQ,SAAA,IAAa,QAAQ;AACzC,YAAA,MAAM,MAAMK,qCAAoB;AAAA,QACpC;AAAA,QACA;AAAA,QACA;AAAA,QACA,cAAc,iBAAiB,CAAC;AAAA,QAChC,UAAU,iBAAiB,CAAC;AAAA,QAC5B,YAAY,iBAAiB,CAAC;AAAA,MAAA,CAC/B;AAEW,kBAAA,QAAS,WAAW,IAAI,OAAO;AAC3CL,oBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAChD,iBAAW,MAAM;AACfA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpHR,GAAG,WAAW,eAAe;"}