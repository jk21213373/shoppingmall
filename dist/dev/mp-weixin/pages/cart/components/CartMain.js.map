{"version":3,"file":"CartMain.js","sources":["../../../../../../src/pages/cart/components/CartMain.vue","../../../../../../uniComponent:/QzovVXNlcnMvRGVsbC9EZXNrdG9wL3Rlc3Qvc3VtbWVyLWZ1bi1zaG9wcGluZy9zcmMvcGFnZXMvY2FydC9jb21wb25lbnRzL0NhcnRNYWluLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport type { InputNumberBoxEvent } from '@/components/vk-data-input-number-box/vk-data-input-number-box'\r\nimport { useGuessList } from '@/composables'\r\nimport {\r\n  deleteMemberCartAPI,\r\n  getMemberCartAPI,\r\n  putMemberCartBySkuIdAPI,\r\n  putMemberCartSelectedAPI,\r\n} from '@/services/cart'\r\nimport { useMemberStore } from '@/stores'\r\nimport type { CartItem } from '@/types/cart'\r\nimport { onShow } from '@dcloudio/uni-app'\r\nimport { computed, ref } from 'vue'\r\n\r\n// 是否适配底部安全区域\r\ndefineProps<{\r\n  safeAreaInsetBottom?: boolean\r\n}>()\r\n\r\n// 获取屏幕边界到安全区域距离\r\nconst { safeAreaInsets } = uni.getSystemInfoSync()\r\n\r\n// 获取会员Store\r\nconst memberStore = useMemberStore()\r\n\r\n// 获取购物车数据\r\nconst cartList = ref<CartItem[]>([])\r\n// 优化购物车空列表状态，默认展示列表\r\nconst showCartList = ref(true)\r\nconst getMemberCartData = async () => {\r\n  const res = await getMemberCartAPI()\r\n  cartList.value = res.result\r\n  showCartList.value = res.result.length > 0\r\n}\r\n\r\n// 初始化调用: 页面显示触发\r\nonShow(() => {\r\n  if (memberStore.profile) {\r\n    getMemberCartData()\r\n  }\r\n})\r\n\r\n// 点击删除按钮\r\nconst onDeleteCart = (skuId: string) => {\r\n  // 弹窗二次确认\r\n  uni.showModal({\r\n    content: '是否删除',\r\n    confirmColor: '#27BA9B',\r\n    success: async (res) => {\r\n      if (res.confirm) {\r\n        // 后端删除单品\r\n        await deleteMemberCartAPI({ ids: [skuId] })\r\n        // 重新获取列表\r\n        getMemberCartData()\r\n      }\r\n    },\r\n  })\r\n}\r\n\r\n// 修改商品数量\r\nconst onChangeCount = (ev: InputNumberBoxEvent) => {\r\n  putMemberCartBySkuIdAPI(ev.index, { count: ev.value })\r\n}\r\n\r\n// 修改选中状态-单品修改\r\nconst onChangeSelected = (item: CartItem) => {\r\n  // 前端数据更新-是否选中取反\r\n  item.selected = !item.selected\r\n  // 后端数据更新\r\n  putMemberCartBySkuIdAPI(item.skuId, { selected: item.selected })\r\n}\r\n\r\n// 计算全选状态\r\nconst isSelectedAll = computed(() => {\r\n  return cartList.value.length && cartList.value.every((v) => v.selected)\r\n})\r\n\r\n// 修改选中状态-全选修改\r\nconst onChangeSelectedAll = () => {\r\n  // 全选状态取反\r\n  const _isSelectedAll = !isSelectedAll.value\r\n  // 前端数据更新\r\n  cartList.value.forEach((item) => {\r\n    item.selected = _isSelectedAll\r\n  })\r\n  // 后端数据更新\r\n  putMemberCartSelectedAPI({ selected: _isSelectedAll })\r\n}\r\n\r\n// 计算选中单品列表\r\nconst selectedCartList = computed(() => {\r\n  return cartList.value.filter((v) => v.selected)\r\n})\r\n\r\n// 计算选中总件数\r\nconst selectedCartListCount = computed(() => {\r\n  return selectedCartList.value.reduce((sum, item) => sum + item.count, 0)\r\n})\r\n\r\n// 计算选中总金额\r\nconst selectedCartListMoney = computed(() => {\r\n  return selectedCartList.value\r\n    .reduce((sum, item) => sum + item.count * item.nowPrice, 0)\r\n    .toFixed(2)\r\n})\r\n\r\n// 结算按钮\r\nconst gotoPayment = () => {\r\n  if (selectedCartListCount.value === 0) {\r\n    return uni.showToast({\r\n      icon: 'none',\r\n      title: '请选择商品',\r\n    })\r\n  }\r\n  // 跳转到结算页\r\n  uni.navigateTo({ url: '/pagesOrder/create/create' })\r\n}\r\n\r\n// 猜你喜欢\r\nconst { guessRef, onScrolltolower } = useGuessList()\r\n</script>\r\n\r\n<template>\r\n  <scroll-view enable-back-to-top scroll-y class=\"scroll-view\" @scrolltolower=\"onScrolltolower\">\r\n    <!-- 已登录: 显示购物车 -->\r\n    <template v-if=\"memberStore.profile\">\r\n      <!-- 购物车列表 -->\r\n      <view class=\"cart-list\" v-if=\"showCartList\">\r\n        <!-- 优惠提示 -->\r\n        <view class=\"tips\">\r\n          <text class=\"label\">满减</text>\r\n          <text class=\"desc\">满1件, 即可享受9折优惠</text>\r\n        </view>\r\n        <!-- 滑动操作分区 -->\r\n        <uni-swipe-action>\r\n          <!-- 滑动操作项 -->\r\n          <uni-swipe-action-item v-for=\"item in cartList\" :key=\"item.skuId\" class=\"cart-swipe\">\r\n            <!-- 商品信息 -->\r\n            <view class=\"goods\">\r\n              <!-- 选中状态 -->\r\n              <text @tap=\"onChangeSelected(item)\" class=\"checkbox\" :class=\"{ checked: item.selected }\"></text>\r\n              <navigator :url=\"`/pages/goods/goods?id=${item.id}`\" hover-class=\"none\" class=\"navigator\">\r\n                <image mode=\"aspectFill\" class=\"picture\" :src=\"item.picture\"></image>\r\n                <view class=\"meta\">\r\n                  <view class=\"name ellipsis\">{{ item.name }}</view>\r\n                  <view class=\"attrsText ellipsis\">{{ item.attrsText }}</view>\r\n                  <view class=\"price\">{{ item.nowPrice }}</view>\r\n                </view>\r\n              </navigator>\r\n              <!-- 商品数量 -->\r\n              <view class=\"count\">\r\n                <vk-data-input-number-box v-model=\"item.count\" :min=\"1\" :max=\"item.stock\" :index=\"item.skuId\"\r\n                  @change=\"onChangeCount\" />\r\n              </view>\r\n            </view>\r\n            <!-- 右侧删除按钮 -->\r\n            <template #right>\r\n              <view class=\"cart-swipe-right\">\r\n                <button @tap=\"onDeleteCart(item.skuId)\" class=\"button delete-button\">删除</button>\r\n              </view>\r\n            </template>\r\n          </uni-swipe-action-item>\r\n        </uni-swipe-action>\r\n      </view>\r\n      <!-- 购物车空状态 -->\r\n      <view class=\"cart-blank\" v-else>\r\n        <image src=\"/static/images/blank_cart.png\" class=\"image\" />\r\n        <text class=\"text\">购物车还是空的，快来挑选好货吧</text>\r\n        <navigator url=\"/pages/index/index\" hover-class=\"none\">\r\n          <button class=\"button\">去首页看看</button>\r\n        </navigator>\r\n      </view>\r\n      <!-- 吸底工具栏 -->\r\n      <view v-if=\"showCartList\" class=\"toolbar\"\r\n        :style=\"{ paddingBottom: safeAreaInsetBottom ? safeAreaInsets?.bottom + 'px' : 0 }\">\r\n        <text @tap=\"onChangeSelectedAll\" class=\"all\" :class=\"{ checked: isSelectedAll }\">全选</text>\r\n        <text class=\"text\">合计:</text>\r\n        <text class=\"amount\">{{ selectedCartListMoney }}</text>\r\n        <view class=\"button-grounp\">\r\n          <view @tap=\"gotoPayment\" class=\"button payment-button\" :class=\"{ disabled: selectedCartListCount === 0 }\">\r\n            去结算({{ selectedCartListCount }})\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </template>\r\n    <!-- 未登录: 提示登录 -->\r\n    <view class=\"login-blank\" v-else>\r\n      <text class=\"text\">登录后可查看购物车中的商品</text>\r\n      <navigator url=\"/pages/login/login\" hover-class=\"none\">\r\n        <button class=\"button\">去登录</button>\r\n      </navigator>\r\n    </view>\r\n    <!-- 猜你喜欢 -->\r\n    <XRBFGuess ref=\"guessRef\" />\r\n    <!-- 底部占位空盒子 -->\r\n    <view class=\"toolbar-height\"></view>\r\n  </scroll-view>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n// 根元素\r\n:host {\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  overflow: hidden;\r\n  background-color: #f7f7f8;\r\n}\r\n\r\n// 滚动容器\r\n.scroll-view {\r\n  flex: 1;\r\n  background-color: #f7f7f8;\r\n}\r\n\r\n// 购物车列表\r\n.cart-list {\r\n  padding: 0 20rpx;\r\n\r\n  // 优惠提示\r\n  .tips {\r\n    display: flex;\r\n    align-items: center;\r\n    line-height: 1;\r\n    margin: 30rpx 10rpx;\r\n    font-size: 26rpx;\r\n    color: #666;\r\n\r\n    .label {\r\n      color: #fff;\r\n      padding: 7rpx 15rpx 5rpx;\r\n      border-radius: 4rpx;\r\n      font-size: 24rpx;\r\n      background-color: #27ba9b;\r\n      margin-right: 10rpx;\r\n    }\r\n  }\r\n\r\n  // 购物车商品\r\n  .goods {\r\n    display: flex;\r\n    padding: 20rpx 20rpx 20rpx 80rpx;\r\n    border-radius: 10rpx;\r\n    background-color: #fff;\r\n    position: relative;\r\n\r\n    .navigator {\r\n      display: flex;\r\n    }\r\n\r\n    .checkbox {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      width: 80rpx;\r\n      height: 100%;\r\n\r\n      &::before {\r\n        content: '\\e6cd';\r\n        font-family: 'erabbit' !important;\r\n        font-size: 40rpx;\r\n        color: #444;\r\n      }\r\n\r\n      &.checked::before {\r\n        content: '\\e6cc';\r\n        color: #27ba9b;\r\n      }\r\n    }\r\n\r\n    .picture {\r\n      width: 170rpx;\r\n      height: 170rpx;\r\n    }\r\n\r\n    .meta {\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      margin-left: 20rpx;\r\n    }\r\n\r\n    .name {\r\n      height: 72rpx;\r\n      font-size: 26rpx;\r\n      color: #444;\r\n    }\r\n\r\n    .attrsText {\r\n      line-height: 1.8;\r\n      padding: 0 15rpx;\r\n      font-size: 24rpx;\r\n      align-self: flex-start;\r\n      border-radius: 4rpx;\r\n      color: #888;\r\n      background-color: #f7f7f8;\r\n    }\r\n\r\n    .price {\r\n      line-height: 1;\r\n      font-size: 26rpx;\r\n      color: #444;\r\n      margin-bottom: 2rpx;\r\n      color: #cf4444;\r\n\r\n      &::before {\r\n        content: '￥';\r\n        font-size: 80%;\r\n      }\r\n    }\r\n\r\n    // 商品数量\r\n    .count {\r\n      position: absolute;\r\n      bottom: 20rpx;\r\n      right: 5rpx;\r\n\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      width: 220rpx;\r\n      height: 48rpx;\r\n\r\n      .text {\r\n        height: 100%;\r\n        padding: 0 20rpx;\r\n        font-size: 32rpx;\r\n        color: #444;\r\n      }\r\n\r\n      .input {\r\n        height: 100%;\r\n        text-align: center;\r\n        border-radius: 4rpx;\r\n        font-size: 24rpx;\r\n        color: #444;\r\n        background-color: #f6f6f6;\r\n      }\r\n    }\r\n  }\r\n\r\n  .cart-swipe {\r\n    display: block;\r\n    margin: 20rpx 0;\r\n  }\r\n\r\n  .cart-swipe-right {\r\n    display: flex;\r\n    height: 100%;\r\n\r\n    .button {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      width: 50px;\r\n      padding: 6px;\r\n      line-height: 1.5;\r\n      color: #fff;\r\n      font-size: 26rpx;\r\n      border-radius: 0;\r\n    }\r\n\r\n    .delete-button {\r\n      background-color: #cf4444;\r\n    }\r\n  }\r\n}\r\n\r\n// 空状态\r\n.cart-blank,\r\n.login-blank {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex-direction: column;\r\n  height: 60vh;\r\n\r\n  .image {\r\n    width: 400rpx;\r\n    height: 281rpx;\r\n  }\r\n\r\n  .text {\r\n    color: #444;\r\n    font-size: 26rpx;\r\n    margin: 20rpx 0;\r\n  }\r\n\r\n  .button {\r\n    width: 240rpx !important;\r\n    height: 60rpx;\r\n    line-height: 60rpx;\r\n    margin-top: 20rpx;\r\n    font-size: 26rpx;\r\n    border-radius: 60rpx;\r\n    color: #fff;\r\n    background-color: #27ba9b;\r\n  }\r\n}\r\n\r\n// 吸底工具栏\r\n.toolbar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: calc(var(--window-bottom));\r\n  z-index: 1;\r\n\r\n  height: 100rpx;\r\n  padding: 0 20rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  border-top: 1rpx solid #ededed;\r\n  border-bottom: 1rpx solid #ededed;\r\n  background-color: #fff;\r\n  box-sizing: content-box;\r\n\r\n  .all {\r\n    margin-left: 25rpx;\r\n    font-size: 14px;\r\n    color: #444;\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n\r\n  .all::before {\r\n    font-family: 'erabbit' !important;\r\n    content: '\\e6cd';\r\n    font-size: 40rpx;\r\n    margin-right: 8rpx;\r\n  }\r\n\r\n  .checked::before {\r\n    content: '\\e6cc';\r\n    color: #27ba9b;\r\n  }\r\n\r\n  .text {\r\n    margin-right: 8rpx;\r\n    margin-left: 32rpx;\r\n    color: #444;\r\n    font-size: 14px;\r\n  }\r\n\r\n  .amount {\r\n    font-size: 20px;\r\n    color: #cf4444;\r\n\r\n    .decimal {\r\n      font-size: 12px;\r\n    }\r\n\r\n    &::before {\r\n      content: '￥';\r\n      font-size: 12px;\r\n    }\r\n  }\r\n\r\n  .button-grounp {\r\n    margin-left: auto;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    text-align: center;\r\n    line-height: 72rpx;\r\n    font-size: 13px;\r\n    color: #fff;\r\n\r\n    .button {\r\n      width: 240rpx;\r\n      margin: 0 10rpx;\r\n      border-radius: 72rpx;\r\n    }\r\n\r\n    .payment-button {\r\n      background-color: #27ba9b;\r\n\r\n      &.disabled {\r\n        opacity: 0.6;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// 底部占位空盒子\r\n.toolbar-height {\r\n  height: 100rpx;\r\n}\r\n</style>\r\n","import Component from 'C:/Users/Dell/Desktop/test/summer-fun-shopping/src/pages/cart/components/CartMain.vue'\nwx.createComponent(Component)"],"names":["uni","useMemberStore","ref","getMemberCartAPI","onShow","deleteMemberCartAPI","putMemberCartBySkuIdAPI","computed","putMemberCartSelectedAPI","useGuessList"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAGjD,UAAM,cAAcC,sBAAAA;AAGd,UAAA,WAAWC,kBAAgB,CAAA,CAAE;AAE7B,UAAA,eAAeA,kBAAI,IAAI;AAC7B,UAAM,oBAAoB,YAAY;AAC9B,YAAA,MAAM,MAAMC,cAAAA;AAClB,eAAS,QAAQ,IAAI;AACR,mBAAA,QAAQ,IAAI,OAAO,SAAS;AAAA,IAAA;AAI3CC,kBAAAA,OAAO,MAAM;AACX,UAAI,YAAY,SAAS;AACL;MACpB;AAAA,IAAA,CACD;AAGK,UAAA,eAAe,CAAC,UAAkB;AAEtCJ,oBAAAA,MAAI,UAAU;AAAA,QACZ,SAAS;AAAA,QACT,cAAc;AAAA,QACd,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AAEf,kBAAMK,kCAAoB,EAAE,KAAK,CAAC,KAAK,EAAG,CAAA;AAExB;UACpB;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAIG,UAAA,gBAAgB,CAAC,OAA4B;AACjDC,oBAAA,wBAAwB,GAAG,OAAO,EAAE,OAAO,GAAG,OAAO;AAAA,IAAA;AAIjD,UAAA,mBAAmB,CAAC,SAAmB;AAEtC,WAAA,WAAW,CAAC,KAAK;AAEtBA,oBAAA,wBAAwB,KAAK,OAAO,EAAE,UAAU,KAAK,UAAU;AAAA,IAAA;AAI3D,UAAA,gBAAgBC,cAAAA,SAAS,MAAM;AAC5B,aAAA,SAAS,MAAM,UAAU,SAAS,MAAM,MAAM,CAAC,MAAM,EAAE,QAAQ;AAAA,IAAA,CACvE;AAGD,UAAM,sBAAsB,MAAM;AAE1B,YAAA,iBAAiB,CAAC,cAAc;AAE7B,eAAA,MAAM,QAAQ,CAAC,SAAS;AAC/B,aAAK,WAAW;AAAA,MAAA,CACjB;AAEwBC,oBAAAA,yBAAA,EAAE,UAAU,eAAA,CAAgB;AAAA,IAAA;AAIjD,UAAA,mBAAmBD,cAAAA,SAAS,MAAM;AACtC,aAAO,SAAS,MAAM,OAAO,CAAC,MAAM,EAAE,QAAQ;AAAA,IAAA,CAC/C;AAGK,UAAA,wBAAwBA,cAAAA,SAAS,MAAM;AACpC,aAAA,iBAAiB,MAAM,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,IAAA,CACxE;AAGK,UAAA,wBAAwBA,cAAAA,SAAS,MAAM;AAC3C,aAAO,iBAAiB,MACrB,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,QAAQ,KAAK,UAAU,CAAC,EACzD,QAAQ,CAAC;AAAA,IAAA,CACb;AAGD,UAAM,cAAc,MAAM;AACpB,UAAA,sBAAsB,UAAU,GAAG;AACrC,eAAOP,cAAAA,MAAI,UAAU;AAAA,UACnB,MAAM;AAAA,UACN,OAAO;AAAA,QAAA,CACR;AAAA,MACH;AAEAA,oBAAAA,MAAI,WAAW,EAAE,KAAK,4BAA6B,CAAA;AAAA,IAAA;AAIrD,UAAM,EAAE,UAAU,gBAAgB,IAAIS,kBAAa,aAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtHnD,GAAG,gBAAgB,SAAS;"}