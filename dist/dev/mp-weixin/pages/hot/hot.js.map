{"version":3,"file":"hot.js","sources":["../../../../../src/pages/hot/hot.vue","../../../../../uniPage:/cGFnZXMvaG90L2hvdC52dWU"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { getHotRecommendAPI } from '@/services/hot'\r\nimport type { SubTypeItem } from '@/types/hot'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref } from 'vue'\r\n\r\n// 热门推荐页 标题和url\r\nconst urlMap = [\r\n  { type: '1', title: '特惠推荐', url: '/hot/preference' },\r\n  { type: '2', title: '爆款推荐', url: '/hot/inVogue' },\r\n  { type: '3', title: '一站买全', url: '/hot/oneStop' },\r\n  { type: '4', title: '新鲜好物', url: '/hot/new' },\r\n]\r\n\r\n// uniapp 获取页面参数\r\nconst query = defineProps<{\r\n  type: string\r\n}>()\r\n// console.log(query)\r\nconst currUrlMap = urlMap.find((v) => v.type === query.type)\r\n// 动态设置标题\r\nuni.setNavigationBarTitle({ title: currUrlMap!.title })\r\n\r\n// 推荐封面图\r\nconst bannerPicture = ref('')\r\n// 推荐选项\r\nconst subTypes = ref<(SubTypeItem & { finish?: boolean })[]>([])\r\n// 高亮的下标\r\nconst activeIndex = ref(0)\r\n// 获取热门推荐数据\r\nconst getHotRecommendData = async () => {\r\n  const res = await getHotRecommendAPI(currUrlMap!.url, {\r\n    // 技巧：环境变量，开发环境，修改初始页面方便测试分页结束\r\n    page: import.meta.env.DEV ? 30 : 1,\r\n    pageSize: 10,\r\n  })\r\n  // console.log(res.result.title)\r\n  bannerPicture.value = res.result.bannerPicture\r\n  subTypes.value = res.result.subTypes\r\n}\r\n\r\n// 页面加载\r\nonLoad(() => {\r\n  getHotRecommendData()\r\n})\r\n\r\n// 滚动触底\r\nconst onScrolltolower = async () => {\r\n  // 获取当前选项\r\n  const currsubTypes = subTypes.value[activeIndex.value]\r\n  // 分页条件\r\n  if (currsubTypes.goodsItems.page < currsubTypes.goodsItems.pages) {\r\n    // 当前页码累加\r\n    currsubTypes.goodsItems.page++\r\n  } else {\r\n    // 标记已结束\r\n    currsubTypes.finish = true\r\n    // 退出并轻提示\r\n    return uni.showToast({ icon: 'none', title: '没有更多数据了~' })\r\n  }\r\n\r\n  // 调用API传参\r\n  const res = await getHotRecommendAPI(currUrlMap!.url, {\r\n    subType: currsubTypes.id,\r\n    page: currsubTypes.goodsItems.page,\r\n    pageSize: currsubTypes.goodsItems.pageSize,\r\n  })\r\n  // 新的列表选项\r\n  const newsubTypes = res.result.subTypes[activeIndex.value]\r\n  // 数组追加\r\n  currsubTypes.goodsItems.items.push(...newsubTypes.goodsItems.items)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <view class=\"viewport\">\r\n    <!-- 推荐封面图 -->\r\n    <view class=\"cover\">\r\n      <image class=\"image\" mode=\"widthFix\" :src=\"bannerPicture\"></image>\r\n    </view>\r\n    <!-- 推荐选项 -->\r\n    <view class=\"tabs\">\r\n      <text\r\n        v-for=\"(item, index) in subTypes\"\r\n        :key=\"item.id\"\r\n        class=\"text\"\r\n        :class=\"{ active: index === activeIndex }\"\r\n        @tap=\"activeIndex = index\"\r\n        >{{ item.title }}</text\r\n      >\r\n    </view>\r\n    <!-- 推荐列表 -->\r\n    <scroll-view\r\n      enable-back-to-top\r\n      v-for=\"(item, index) in subTypes\"\r\n      :key=\"item.id\"\r\n      v-show=\"activeIndex === index\"\r\n      scroll-y\r\n      class=\"scroll-view\"\r\n      @scrolltolower=\"onScrolltolower\"\r\n    >\r\n      <view class=\"goods\">\r\n        <navigator\r\n          hover-class=\"none\"\r\n          class=\"navigator\"\r\n          v-for=\"goods in item.goodsItems.items\"\r\n          :key=\"goods.id\"\r\n          :url=\"`/pages/goods/goods?id=${goods.id}`\"\r\n        >\r\n          <image class=\"thumb\" :src=\"goods.picture\"></image>\r\n          <view class=\"name ellipsis\">{{ goods.name }}</view>\r\n          <view class=\"price\">\r\n            <text class=\"symbol\">¥</text>\r\n            <text class=\"number\">{{ goods.price }}</text>\r\n          </view>\r\n        </navigator>\r\n      </view>\r\n      <view class=\"loading-text\">\r\n        {{ item.finish ? '没有更多数据了~' : '正在加载...' }}\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  height: 100%;\r\n  background-color: #f4f4f4;\r\n}\r\n.viewport {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  padding: 180rpx 0 0;\r\n  position: relative;\r\n}\r\n.cover {\r\n  width: 750rpx;\r\n  height: 225rpx;\r\n  border-radius: 0 0 40rpx 40rpx;\r\n  overflow: hidden;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  .image {\r\n    width: 750rpx;\r\n  }\r\n}\r\n.scroll-view {\r\n  flex: 1;\r\n}\r\n.tabs {\r\n  display: flex;\r\n  justify-content: space-evenly;\r\n  height: 100rpx;\r\n  line-height: 90rpx;\r\n  margin: 0 20rpx;\r\n  font-size: 28rpx;\r\n  border-radius: 10rpx;\r\n  box-shadow: 0 4rpx 5rpx rgba(200, 200, 200, 0.3);\r\n  color: #333;\r\n  background-color: #fff;\r\n  position: relative;\r\n  z-index: 9;\r\n  .text {\r\n    margin: 0 20rpx;\r\n    position: relative;\r\n  }\r\n  .active {\r\n    &::after {\r\n      content: '';\r\n      width: 40rpx;\r\n      height: 4rpx;\r\n      transform: translate(-50%);\r\n      background-color: #27ba9b;\r\n      position: absolute;\r\n      left: 50%;\r\n      bottom: 24rpx;\r\n    }\r\n  }\r\n}\r\n.goods {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: space-between;\r\n  padding: 0 20rpx 20rpx;\r\n  .navigator {\r\n    width: 345rpx;\r\n    padding: 20rpx;\r\n    margin-top: 20rpx;\r\n    border-radius: 10rpx;\r\n    background-color: #fff;\r\n  }\r\n  .thumb {\r\n    width: 305rpx;\r\n    height: 305rpx;\r\n  }\r\n  .name {\r\n    height: 88rpx;\r\n    font-size: 26rpx;\r\n  }\r\n  .price {\r\n    line-height: 1;\r\n    color: #cf4444;\r\n    font-size: 30rpx;\r\n  }\r\n  .symbol {\r\n    font-size: 70%;\r\n  }\r\n  .decimal {\r\n    font-size: 70%;\r\n  }\r\n}\r\n\r\n.loading-text {\r\n  text-align: center;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  padding: 20rpx 0 50rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Dell/Desktop/test/summer-fun-shopping/src/pages/hot/hot.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getHotRecommendAPI","onLoad"],"mappings":";;;;;;;;;;;;;AAOA,UAAM,SAAS;AAAA,MACb,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,kBAAkB;AAAA,MACnD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,eAAe;AAAA,MAChD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,eAAe;AAAA,MAChD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,WAAW;AAAA,IAAA;AAQxC,UAAA,aAAa,OAAO,KAAK,CAAC,MAAM,EAAE,SAAS,MAAM,IAAI;AAE3DA,kBAAA,MAAI,sBAAsB,EAAE,OAAO,WAAY,MAAO,CAAA;AAGhD,UAAA,gBAAgBC,kBAAI,EAAE;AAEtB,UAAA,WAAWA,kBAA4C,CAAA,CAAE;AAEzD,UAAA,cAAcA,kBAAI,CAAC;AAEzB,UAAM,sBAAsB,YAAY;AACtC,YAAM,MAAM,MAAMC,gCAAmB,WAAY,KAAK;AAAA;AAAA,QAEpD,MAA4B;AAAA,QAC5B,UAAU;AAAA,MAAA,CACX;AAEa,oBAAA,QAAQ,IAAI,OAAO;AACxB,eAAA,QAAQ,IAAI,OAAO;AAAA,IAAA;AAI9BC,kBAAAA,OAAO,MAAM;AACS;IAAA,CACrB;AAGD,UAAM,kBAAkB,YAAY;AAElC,YAAM,eAAe,SAAS,MAAM,YAAY,KAAK;AAErD,UAAI,aAAa,WAAW,OAAO,aAAa,WAAW,OAAO;AAEhE,qBAAa,WAAW;AAAA,MAAA,OACnB;AAEL,qBAAa,SAAS;AAEtB,eAAOH,cAAAA,MAAI,UAAU,EAAE,MAAM,QAAQ,OAAO,YAAY;AAAA,MAC1D;AAGA,YAAM,MAAM,MAAME,gCAAmB,WAAY,KAAK;AAAA,QACpD,SAAS,aAAa;AAAA,QACtB,MAAM,aAAa,WAAW;AAAA,QAC9B,UAAU,aAAa,WAAW;AAAA,MAAA,CACnC;AAED,YAAM,cAAc,IAAI,OAAO,SAAS,YAAY,KAAK;AAEzD,mBAAa,WAAW,MAAM,KAAK,GAAG,YAAY,WAAW,KAAK;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrEpE,GAAG,WAAW,eAAe;"}